<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * * * The content below * * * * * * * * * * * -->
<!-- * * * * * * * * * * is only a placeholder * * * * * * * * * * -->
<!-- * * * * * * * * * * and can be replaced.  * * * * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->
<!-- * * * * * * * * * Delete the template below * * * * * * * * * -->
<!-- * * * * * * * to get started with your project! * * * * * * * -->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->

<div
  class="username-modal-backdrop"
  *ngIf="isUsernameModalOpen"
>
  <div class="username-modal">
    <h2>Connectez-vous</h2>
    <p>Ce nom sera utilisé pour les noms de compte.</p>
    <input
      type="text"
      name="username"
      [(ngModel)]="usernameInput"
      placeholder="Ton nom"
      maxlength="20"
      autofocus
    />
    <input
      type="password"
      name="password"
      [(ngModel)]="passwordInput"
      placeholder="Mot de passe"
      autocomplete="new-password"
    />
    <p class="password-error" *ngIf="passwordErrorMessage as msg">{{ msg }}</p>
    <div class="username-modal-actions">
      <button type="button" (click)="confirmUsername()">Valider</button>
    </div>
  </div>
</div>

<div
  class="username-modal-backdrop"
  *ngIf="notImplementedModalOpen"
>
  <div class="username-modal">
    <h2>Service non disponible</h2>
    <p>Le service de désabonnement de "{{ notImplementedGameName }}" n'est pas encore disponible, nos équipes travaillent actuellement dessus.</p>
    <div class="username-modal-actions">
      <button type="button" (click)="closeNotImplementedModal()">Fermer</button>
    </div>
  </div>
</div>

<div class="layout-root">
  <aside class="sidebar">
    <div class="sidebar-header">
      <span class="sidebar-title">Unsubscribe Service</span>
    </div>
    <nav class="sidebar-nav">
      <div class="sidebar-section">Menu</div>
      <a class="sidebar-link active" href="javascript:void(0)">Dashboard</a>
      <div class="sidebar-section">Aide</div>
      <a class="sidebar-link" href="javascript:void(0)">Support</a>
      <a class="sidebar-link" href="javascript:void(0)">FAQ</a>
    </nav>
    <div class="sidebar-footer">
      <div class="sidebar-footer-label">Logged in as:</div>
      <div class="sidebar-footer-user">{{ store.username() }}</div>
    </div>
  </aside>

  <div class="main-area">
    <header class="topbar">
      <div class="topbar-left">
        <h1 class="topbar-title">Abonnements et prix</h1>
      </div>
      <div class="topbar-right">
        <div class="account-menu">
          <button type="button" class="account-menu-button" [class.account-menu-button-alert]="!isConnected">
            <span class="account-menu-label">{{ store.username() || 'Mon compte' }}</span>
            <div class="account-menu-avatar" *ngIf="store.avatarUrl()">
              <img [src]="store.avatarUrl()" alt="Avatar" class="account-menu-avatar-img" />
            </div>
            <span class="account-menu-caret">▾</span>
          </button>
          <div class="account-menu-dropdown">
            <button
              type="button"
              class="account-menu-item"
              (click)="openAccountModalFromMenu()"
              *ngIf="!isConnected"
            >
              Se connecter
            </button>
            <button
              type="button"
              class="account-menu-item"
              (click)="openAccountModalFromMenu()"
              *ngIf="isConnected"
            >
              Changer profil
            </button>
            <button
              type="button"
              class="account-menu-item"
              (click)="logout()"
              *ngIf="isConnected"
            >
              Se déconnecter
            </button>
          </div>
        </div>
        <!-- L'avatar est maintenant intégré dans le bouton de compte -->
      </div>
    </header>
    
    <main class="content-area">
      <section class="card">
        <div class="card-header">
          <h2>Mes abonnements</h2>
        </div>
        <div class="card-body">
          <div class="subscriptions-list">
            <ng-container *ngIf="isConnected; else notConnectedCard">
              <div
                class="subscription-card"
                *ngFor="let row of rows"
                [class.subscription-card-disabled]="!row.isImplemented"
              >
                <div class="subscription-card-header">
                  <span class="subscription-name">{{ row.name }}</span>
                  <span *ngIf="row.checked" class="game-checked">✅</span>
                </div>
                <div class="subscription-card-body">
                  <p class="subscription-id"></p>
                </div>
                <div class="subscription-card-footer">
                  <span class="subscription-price">{{ row.prix }} € {{ getPriceUnitLabel(row) }}</span>
                  <ng-container *ngIf="row.isImplemented; else notImplementedTpl">
                    <button
                      type="button"
                      class="btn-game"
                      [routerLink]="row.url"
                      [disabled]="row.checked"
                    >
                      {{ row.checked ? 'Annulé' : 'Se désabonner' }}
                    </button>
                  </ng-container>
                  <ng-template #notImplementedTpl>
                    <button
                      type="button"
                      class="btn-game btn-game-disabled"
                      (click)="showGameNotAvailable(row)"
                    >
                      Bientôt disponible
                    </button>
                  </ng-template>
                </div>
              </div>
            </ng-container>
            <ng-template #notConnectedCard>
              <div class="subscription-card">
                <div class="subscription-card-header">
                  <span class="subscription-name"><h2>Veuillez vous connecter</h2></span>
                </div>
                <div class="subscription-card-body">
                  <h3>Connectez-vous pour voir vos abonnements.</h3>
                </div>
              </div>
            </ng-template>
          </div>
          
          <section class="subscriptions-pricing">
            <h3>Récapitulatif des montants</h3>
            <ul>
              <ng-container *ngIf="isConnected">
                <li *ngFor="let row of rows" [class.price-strike]="row.checked">
                  <span class="price-name">{{ row.name }}</span>
                  <span class="price-month">{{ getPricePerMonth(row) | number: '1.2-2' }} € / mois</span>
                  <span class="price-year">{{ getPricePerYear(row) | number: '1.2-2' }} € / an</span>
                </li>
              </ng-container>
            </ul>
            <div class="price-totals">
              <div class="price-total-row">
                <span></span>
                <span class="price-total-month" *ngIf="isConnected">Total : {{ totalPrice | number: '1.2-2' }} € / mois</span>
                <span class="price-total-year" *ngIf="isConnected">Total : {{ totalYear | number: '1.2-2' }} € / an</span>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>
  </div>
</div>